From 0c94d131abd8a7c7052523c484ff16b7355e7ac8 Mon Sep 17 00:00:00 2001
From: Ivan Semkin <ivan@semkin.ru>
Date: Sat, 15 Sep 2018 21:40:32 +0300
Subject: [PATCH] Fix build with Qt 5.11_beta3 (dropping qt5_use_modules)

---
 .../connectivity-qml/CMakeLists.txt              |  7 +------
 .../connectivity-qt/CMakeLists.txt               |  8 ++------
 src/qdbus-stubs/CMakeLists.txt                   |  4 ++--
 tests/integration/CMakeLists.txt                 | 10 +++-------
 tests/unit/CMakeLists.txt                        | 16 ++++------------
 5 files changed, 12 insertions(+), 33 deletions(-)

diff --git a/src/connectivity-api/connectivity-qml/CMakeLists.txt b/src/connectivity-api/connectivity-qml/CMakeLists.txt
index 1520edc0..06587bdc 100644
--- a/src/connectivity-api/connectivity-qml/CMakeLists.txt
+++ b/src/connectivity-api/connectivity-qml/CMakeLists.txt
@@ -16,14 +16,9 @@ add_library(connectivity-qml SHARED
 target_link_libraries(
   connectivity-qml
   ${CONNECTIVITY_QT_LIB_TARGET}
+  Qt5::Qml
 )
 
-
-qt5_use_modules(connectivity-qml
-  Qml
-)
-
-
 add_qmlplugin(
   Ubuntu.Connectivity
   1.0
diff --git a/src/connectivity-api/connectivity-qt/CMakeLists.txt b/src/connectivity-api/connectivity-qt/CMakeLists.txt
index ec2f80ea..a2af117b 100644
--- a/src/connectivity-api/connectivity-qt/CMakeLists.txt
+++ b/src/connectivity-api/connectivity-qt/CMakeLists.txt
@@ -91,14 +91,10 @@ add_library(
     ${PUBLIC_HEADERS} # public headers have to be included here for Q_DECL_EXPORT to work properly
 )
 
-qt5_use_modules(
-    ${CONNECTIVITY_QT_LIB_TARGET}
-    Core
-    DBus
-)
-
 target_link_libraries(
     ${CONNECTIVITY_QT_LIB_TARGET}
+    Qt5::Core
+    Qt5::DBus
     qdbus-stubs
     util
 )
diff --git a/src/qdbus-stubs/CMakeLists.txt b/src/qdbus-stubs/CMakeLists.txt
index 4b13d41a..efc694a3 100644
--- a/src/qdbus-stubs/CMakeLists.txt
+++ b/src/qdbus-stubs/CMakeLists.txt
@@ -164,7 +164,7 @@ add_library(
     ${CONNECTIVITY_BACKEND_SRC}
 )
 
-qt5_use_modules(
+target_link_libraries(
     qdbus-stubs
-    DBus
+    Qt5::DBus
 )
diff --git a/tests/integration/CMakeLists.txt b/tests/integration/CMakeLists.txt
index a16eeccb..232d2c26 100644
--- a/tests/integration/CMakeLists.txt
+++ b/tests/integration/CMakeLists.txt
@@ -33,15 +33,11 @@ add_executable(
     ${INTEGRATION_TESTS_SRC}
 )
 
-qt5_use_modules(
-    integration-tests
-    Core
-    DBus
-    Test
-)
-
 target_link_libraries(
     integration-tests
+    Qt5::Core
+    Qt5::DBus
+    Qt5::Test
     test-utils
     ${CONNECTIVITY_QT_LIB_TARGET}
     ${TEST_DEPENDENCIES_LDFLAGS}
diff --git a/tests/unit/CMakeLists.txt b/tests/unit/CMakeLists.txt
index 8439a3e2..2560eab7 100644
--- a/tests/unit/CMakeLists.txt
+++ b/tests/unit/CMakeLists.txt
@@ -20,13 +20,9 @@ add_executable(
     secret-agent/secret-agent-main.cpp
 )
 
-qt5_use_modules(
-    secret-agent-test-bin
-    Core
-)
-
 target_link_libraries(
     secret-agent-test-bin
+    Qt5::Core
     agent-static
 )
 
@@ -62,15 +58,11 @@ add_executable(
     ${UNIT_TESTS_SRC}
 )
 
-qt5_use_modules(
-    unit-tests
-    Core
-    DBus
-    Test
-)
-
 target_link_libraries(
     unit-tests
+    Qt5::Core
+    Qt5::DBus
+    Qt5::Test
     test-utils
     indicator-network-service-static
     ${TEST_DEPENDENCIES_LDFLAGS}
